import { Button, Card, Grid, Row, Text } from "@nextui-org/react";
import Head from "next/head";
import React, { useEffect, useState } from "react";
import NewMeetupForm from "../../components/Forms/NewMeetupForm";
import NavBar from "../../components/NavBar";
import Modal from "../../components/UI/Modal";
import { useQuery } from "@apollo/client";
import { MEETUP_LIST } from "../../graphql/queries";
import { useAuthenticationStatus } from "@nhost/nextjs";
import { useRouter } from "next/router";
import { ImLocation } from "react-icons/im";

interface IMeetupProps {
  meetup_list: {
    meetup_address: string;
    meetup_description: string;
    meetup_image: string;
    meetup_title: string;
    uuid: string;
  }[];
}

const MeetUps = () => {
  const [open, setOpen] = useState<boolean>(false);
  const [meetupData, setMeetupData] = useState<IMeetupProps | null>(null);
  const { data } = useQuery(MEETUP_LIST);

  const router = useRouter();

  useEffect(() => {
    setMeetupData(data);
  }, [data]);

  const { isAuthenticated } = useAuthenticationStatus();

  if (!isAuthenticated) {
    router.push("/");
  }

  return (
    <>
      <Head>
        <title>Let&apos;s Link | All Meetups</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>

      <NavBar />
      <Row css={{ my: 20 }} justify="center">
        <Button shadow color="secondary" auto onClick={() => setOpen(true)}>
          Add New Meetup
        </Button>
      </Row>

      <Modal
        onOpen={open}
        onClose={() => setOpen(false)}
        modalTitle="Add New Meetup"
      >
        <NewMeetupForm onClose={() => setOpen(false)} />
      </Modal>
      <Grid.Container className=" grid grid-cols-1" gap={2} justify="center">
        {meetupData?.meetup_list.map((item) => (
          <Grid sm={12} md={5} xl={3} key={item.uuid}>
            <Card>
              <Card.Body css={{ p: 0 }}>
                <Card.Image
                  src="https://nextui.org/images/card-example-5.jpeg"
                  objectFit="cover"
                  width="100%"
                  height="100%"
                  alt="Relaxing app background"
                />
              </Card.Body>
              <Card.Divider />
              <Card.Footer>
                <div className="flex flex-col justify-center items-center w-full ">
                  <Text css={{ color: "black" }}>{item.meetup_title}</Text>
                  <div className="flex items-center mt-2 gap-2">
                    <ImLocation />
                    <Text css={{ color: "black" }}>{item.meetup_address}</Text>
                  </div>

                  <Button
                    css={{ mt: 10 }}
                    flat
                    auto
                    rounded
                    color={"secondary"}
                  >
                    Show Details
                  </Button>
                </div>
              </Card.Footer>
            </Card>
          </Grid>
        ))}
      </Grid.Container>
    </>
  );
};

export default MeetUps;
